<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Jon Minton">
<meta name="dcterms.date" content="2023-12-14">

<title>Jon Minton’s Blog - Nerdy Dialogues on Life and Death</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-text-highlighting-styles">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting-dark.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" class="quarto-color-scheme" id="quarto-bootstrap" data-mode="light">
<link href="../../site_libs/bootstrap/bootstrap-dark.min.css" rel="stylesheet" class="quarto-color-scheme quarto-color-alternate" id="quarto-bootstrap" data-mode="dark">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<link rel="stylesheet" href="../../styles.css">
<meta name="twitter:title" content="Jon Minton’s Blog - Nerdy Dialogues on Life and Death">
<meta name="twitter:description" content="Part 1: Introduction; Life Expectancy">
<meta name="twitter:image" content="https://JonMinton.github.io/jon-blog/posts/socatic-dialogue-part-01/images/ABDEC269-EDFD-4BD8-857E-984F61FCE1B9.jpg">
<meta name="twitter:site" content="@jonminton">
<meta name="twitter:card" content="summary_large_image">
</head>

<body class="nav-fixed fullcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">Jon Minton’s Blog</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../glms.html" rel="" target="">
 <span class="menu-text">Generalised Linear Models</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../about.html" rel="" target="">
 <span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://jonminton.net" rel="" target=""><i class="bi bi-window-fullscreen" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/JonMinton" rel="" target=""><i class="bi bi-github" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/JonMinton" rel="" target=""><i class="bi bi-twitter" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://uk.linkedin.com/in/jon-minton-09480b13a" rel="" target=""><i class="bi bi-linkedin" role="img">
</i> 
 <span class="menu-text"></span></a>
  </li>  
</ul>
            <div class="quarto-navbar-tools">
  <a href="" class="quarto-color-scheme-toggle quarto-navigation-tool  px-1" onclick="window.quartoToggleColorScheme(); return false;" title="Toggle dark mode"><i class="bi"></i></a>
</div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Nerdy Dialogues on Life and Death</h1>
            <p class="subtitle lead">Part 1: Introduction; Life Expectancy</p>
                                <div class="quarto-categories">
                <div class="quarto-category">demography</div>
                <div class="quarto-category">population health</div>
                <div class="quarto-category">methodology</div>
              </div>
                  </div>
  </div>
    
  
  <div class="quarto-title-meta">

      <div>
      <div class="quarto-title-meta-heading">Author</div>
      <div class="quarto-title-meta-contents">
               <p>Jon Minton </p>
            </div>
    </div>
      
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">December 14, 2023</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">




<div class="quarto-figure quarto-figure-center">
<figure class="figure">
<p><img src="images/ABDEC269-EDFD-4BD8-857E-984F61FCE1B9.jpg" class="img-fluid figure-img"></p>
<figcaption class="figure-caption">Two cats, Emu and Goose. Goose is invading Emu’s personal space slightly</figcaption>
</figure>
</div>
<p>Here’s an attempt to think some more about how and why standardised rates are used to compare populations. I’m doing so via the medium of a Socratic Dialogue<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>.</p>
<section id="why-age-standardise-a-dialogue" class="level2">
<h2 class="anchored" data-anchor-id="why-age-standardise-a-dialogue">Why age standardise? A dialogue</h2>
<p><em>More than twice as many deaths are reported in population A than population B</em></p>
<p>First question: Does population A have about twice the population as population B?</p>
<p><em>Okay. I’ve got the number of deaths in population A,</em> <span class="math inline">\(n_A\)</span><em>, and the population size in population A,</em> <span class="math inline">\(N_A\)</span><em>. So, I’ve calculated the rate</em> <span class="math inline">\(r_A = \frac{n_A}{N_A}\)</span> <em>for population A, and done the same for population B,</em> <span class="math inline">\(r_B = \frac{n_B}{N_B}\)</span><em>.</em></p>
<p>Okay… so what’s the ratio of <span class="math inline">\(r_A\)</span> to <span class="math inline">\(r_B\)</span>?</p>
<p><em>It’s 1.4. So, the mortality rate in population A is 40% higher than in population B</em></p>
<p>And what does that mean?</p>
<p><em>Population A are exposed to more of something bad, or maybe less to something good, than those in population B.</em></p>
<p>Possibly. What if I told you that the mortality rate in a care home was 40% higher than the mortality rate in a combat unit fighting on the front line? If the differences in rates is just due to differences in exposures, surely if we were to move the people in the care home into the combat unit, the differences in mortality rates between the two populations should disappear?</p>
<p><em>That doesn’t sound right. I think the mortality rates of the care home population would be even higher if they were in the combat unit.</em></p>
<p>And what does that imply?</p>
<p><em>Differences in health outcomes between populations can be due to differences in the characteristics of the populations being compared, as well as differences in the exposures the two populations encounter</em></p>
<p>Exactly. And what are the main differences in characteristics between the care home population and the combat unit population likely to be?</p>
<p><em>I’d expect the combat unit population to be much younger than the care home population. I’d also expect the combat unit population to be overwhelmingly male, whereas the care home population might be more mixed, but perhaps skewed more towards females than males.</em></p>
<p>Good. So what does this mean for methodology?</p>
<p><em>We need to look to compare like-with-like when trying to work out how much of a difference in health outcome is due to differences in exposures. At the very least, we should try to compare like-with-like on age and sex, as these are very important determinants of mortality risk.</em></p>
<p>Great. So, instead of just a single ratio to compare between populations, we can compare a load of ratios, one for each combination of age and sex we’ve got common data for. So, the ratio of mortality rates in 25 year old females, 37 year old males, 60 year old females, 82 year old males, and so on…</p>
<p><em>Maybe…</em></p>
<p>If we’ve got males and females, each by age in single year up to age 90, that means we have almost 200 such ratios to compare. Any difficulties with that?</p>
<p><em>I guess that makes it hard to see the wood for the trees, one or two numbers is easier to convey than one hundred or two hundred.</em></p>
<p>…</p>
<p><em>So I guess we need some way of summarising this further, making sure the summary measure presented is a reasonable summary of all of the like-with-like comparisons we’ve got?</em></p>
<p>Yes. What might be some ways of doing this?</p>
<p><em>I guess we could do something like the mean or median value of these age-sex specific ratios??</em></p>
<p>From first principles, that doesn’t seem like a terrible idea. However it would have some problems.</p>
<p><em>Such as?</em></p>
<p>For example, if a few ratios are based on small numbers of deaths and population counts, they could be very big or very small due to sample estimation issues alone. This would be more of an issue if using the mean than the median.</p>
<p>Also all subpopulations’ estimates would contribute equally to such a summary measure, even if some subpopulations contribute much more to the overall health outcome in the population than others.</p>
<p><em>So, what are some better alternatives?</em></p>
<p>Well, I guess, for overall mortality, you could use life expectancy.</p>
<p><em>Ah, we’re all familiar with that.</em></p>
<p>Maybe not as familiar as you think you are. It’s <a href="https://ourworldindata.org/life-expectancy-how-is-it-calculated-and-how-should-it-be-interpreted#article-citation">less straightforward to calculate and interpret</a> than you might think. For example, imagine it’s 1890, and life expectancy is 51 years of age. You’re 31 years old. How long can you expect to live?</p>
<p><em>Twenty more years? More if I’m careful</em></p>
<p>Probably quite a bit longer. ‘Life expectancy’ <span class="math inline">\(e\)</span> is usually used as shorthand for ‘period life expectancy from birth’, <span class="math inline">\(e_0\)</span>, or ‘unconditional period life expectancy’. Historically, the first year of life was one of the most dangerous ages to be alive.<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a> It’s a tall and weighty hurdle to cross. But as a 31 year old you’ve already crossed it. Your life expectancy isn’t ‘unconditional’ life expectancy from birth, <span class="math inline">\(e_0\)</span>, but ‘conditional’ life expectancy from age 31, <span class="math inline">\(e_{31}\)</span>.</p>
<p><em>What does this mean?</em></p>
<p>Say there were 10,000 people running the obstacle course of life, and they’re starting at the start of the course. The further you follow the course along, the fewer people reach each stage. Life expectancy at birth <span class="math inline">\(e_0\)</span>, heuristically, answers the question “at what stage in the course should you expect there’ll only be 5,000 of the original contestants remaining, on average?”</p>
<p><em>And</em> <span class="math inline">\(e_{31}\)</span>?</p>
<p>Almost the same, except instead of the 10,000 people starting at the start of the course, they’re all allowed to start at stage 31 instead.</p>
<p><em>Ah! I think I see now why</em> <span class="math inline">\(e_{31}\)</span> <em>should be greater than</em> <span class="math inline">\(e_0\)</span>!</p>
<p>Yes, and as mentioned it used to be a lot higher, because the first stage used to be one of the toughest.</p>
<p><em>Okay. I think I understand why life expectancy isn’t a completely straightforward concept. Let’s go into the weeds even further. Why did you refer to life expectancy as period life expectancy? What’s the alternative?</em></p>
<p>Well, let’s keep with the obstacle course analogy. Imagine two more things…</p>
<p><em>Okay, but you’re hurting my brain.</em></p>
<p>… Firstly, that the 10,000 contestants aren’t all the contestants. Instead, they’re just one of a series of cohorts of contestants. Every fifteen minutes, say, another 10,000 contestants are lined up at the starting block and, when <em>their</em> starting pistol goes, they start the course.</p>
<p><em>Sounds pretty crowded…</em></p>
<p>Yes. None of this is practically possible; we also have to assume everyone runs at the same rate for the analogy to work.</p>
<p>Anyway, the second big thing to imagine is that the designers of the obstacle course are <em>constantly redesigning it</em>. They’re making some of the hurdles higher, and other hurdles lower, and they’re doing this all the time.</p>
<p><em>Ah, so the obstacle course is never the same for any two cohorts who traverse it?</em></p>
<p>Exactly! You’ve got it!<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></p>
<p><em>So, it’s cohorts who traverse the course, but you said life expectancy is usually period life expectancy. What does this mean?</em></p>
<p>A period life expectancy is like taking a snapshot, or just a few seconds-long clip, of people who are currently on the obstacle course, at all stages, and using this information to try to work out how far a cohort, starting at the start of the course, would likely get along the course, <em>if the obstacle course never changed while the cohort is traversing the course</em>.</p>
<p><em>That sounds like an important caveat, given you just said the course is always changing.</em></p>
<p>It certainly is. It’s for this reason a period life expectancy is sometimes also called a <em>synthetic cohort</em> life expectancy, because the cohort imagined to traverse the obstacle course doesn’t actually exist, but is made up of different pieces of different cohorts at different stages of the course.</p>
<p><em>So, why not use a real cohort?</em></p>
<p>Two reasons: Relevance, and data.</p>
<p><em>Go on..</em></p>
<p>Either you have a completed cohort, where there’s the data, but not the relevance. Or you have an incomplete cohort, where there’s the relevance, but not the data.</p>
<p><em>I think I understand: The completed cohort completed the obstacle course, especially the start of it, when it was very different to how it is now, so although the data’s complete, much of it doesn’t speak to the current challenges on the course. And for the incomplete cohort, as they’ve not yet reached all the hurdles, we can’t yet know how many of them will reach each stage.</em></p>
<p>Correct, and correct. Two reasons why period life expectancies are usually used, even though they’re based on some pretty weird fictions.</p>
<p><em>This whole dialogue is a weird fiction. Shall we call it a night?</em></p>
<p>Indeed we shall!</p>


</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>i.e.&nbsp;two people talking about an idea, one of whom thinks they know more than the other one, though, very annoyingly, insists they don’t.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>Existing starts with a boss fight.<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>My Socrates doesn’t intend this to sound condescending, but it still does a bit.<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const disableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'prefetch';
    }
  }
  const enableStylesheet = (stylesheets) => {
    for (let i=0; i < stylesheets.length; i++) {
      const stylesheet = stylesheets[i];
      stylesheet.rel = 'stylesheet';
    }
  }
  const manageTransitions = (selector, allowTransitions) => {
    const els = window.document.querySelectorAll(selector);
    for (let i=0; i < els.length; i++) {
      const el = els[i];
      if (allowTransitions) {
        el.classList.remove('notransition');
      } else {
        el.classList.add('notransition');
      }
    }
  }
  const toggleColorMode = (alternate) => {
    // Switch the stylesheets
    const alternateStylesheets = window.document.querySelectorAll('link.quarto-color-scheme.quarto-color-alternate');
    manageTransitions('#quarto-margin-sidebar .nav-link', false);
    if (alternate) {
      enableStylesheet(alternateStylesheets);
      for (const sheetNode of alternateStylesheets) {
        if (sheetNode.id === "quarto-bootstrap") {
          toggleBodyColorMode(sheetNode);
        }
      }
    } else {
      disableStylesheet(alternateStylesheets);
      toggleBodyColorPrimary();
    }
    manageTransitions('#quarto-margin-sidebar .nav-link', true);
    // Switch the toggles
    const toggles = window.document.querySelectorAll('.quarto-color-scheme-toggle');
    for (let i=0; i < toggles.length; i++) {
      const toggle = toggles[i];
      if (toggle) {
        if (alternate) {
          toggle.classList.add("alternate");     
        } else {
          toggle.classList.remove("alternate");
        }
      }
    }
    // Hack to workaround the fact that safari doesn't
    // properly recolor the scrollbar when toggling (#1455)
    if (navigator.userAgent.indexOf('Safari') > 0 && navigator.userAgent.indexOf('Chrome') == -1) {
      manageTransitions("body", false);
      window.scrollTo(0, 1);
      setTimeout(() => {
        window.scrollTo(0, 0);
        manageTransitions("body", true);
      }, 40);  
    }
  }
  const isFileUrl = () => { 
    return window.location.protocol === 'file:';
  }
  const hasAlternateSentinel = () => {  
    let styleSentinel = getColorSchemeSentinel();
    if (styleSentinel !== null) {
      return styleSentinel === "alternate";
    } else {
      return false;
    }
  }
  const setStyleSentinel = (alternate) => {
    const value = alternate ? "alternate" : "default";
    if (!isFileUrl()) {
      window.localStorage.setItem("quarto-color-scheme", value);
    } else {
      localAlternateSentinel = value;
    }
  }
  const getColorSchemeSentinel = () => {
    if (!isFileUrl()) {
      const storageValue = window.localStorage.getItem("quarto-color-scheme");
      return storageValue != null ? storageValue : localAlternateSentinel;
    } else {
      return localAlternateSentinel;
    }
  }
  let localAlternateSentinel = 'alternate';
  // Dark / light mode switch
  window.quartoToggleColorScheme = () => {
    // Read the current dark / light value 
    let toAlternate = !hasAlternateSentinel();
    toggleColorMode(toAlternate);
    setStyleSentinel(toAlternate);
  };
  // Ensure there is a toggle, if there isn't float one in the top right
  if (window.document.querySelector('.quarto-color-scheme-toggle') === null) {
    const a = window.document.createElement('a');
    a.classList.add('top-right');
    a.classList.add('quarto-color-scheme-toggle');
    a.href = "";
    a.onclick = function() { try { window.quartoToggleColorScheme(); } catch {} return false; };
    const i = window.document.createElement("i");
    i.classList.add('bi');
    a.appendChild(i);
    window.document.body.appendChild(a);
  }
  // Switch to dark mode if need be
  if (hasAlternateSentinel()) {
    toggleColorMode(true);
  } else {
    toggleColorMode(false);
  }
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<script src="https://utteranc.es/client.js" repo="JonMinton/BlogComments" issue-term="pathname" theme="github-light" crossorigin="anonymous" async="">
</script>
</div> <!-- /content -->



</body></html>