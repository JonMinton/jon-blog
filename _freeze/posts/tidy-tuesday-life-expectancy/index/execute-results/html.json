{
  "hash": "fcf522f4e9d53468003712520a9a7540",
  "result": {
    "markdown": "---\ntitle: \"Tidy Tuesday on Life Expectancy\"\nauthor: \n  - \"Nick Christofides\"\n  - \"Jon Minton\"\ndate: \"2023-12-06\"\ncategories: [R, tidy tuesday, Life Expectancy]\n---\n\n\nThis week's Tidy Tuesday compares life expectancy across the globe and is available here:\n\n## Loading the data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nWarning: package 'dplyr' was built under R version 4.2.3\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.4\n✔ forcats   1.0.0     ✔ stringr   1.5.0\n✔ ggplot2   3.4.3     ✔ tibble    3.2.1\n✔ lubridate 1.9.2     ✔ tidyr     1.3.0\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n:::\n\n```{.r .cell-code}\nlibrary(tidytuesdayR)\ndata_url <- \"https://raw.githubusercontent.com/rfordatascience/tidytuesday/master/data/2023/2023-12-05/life_expectancy_different_ages.csv\"\n \ndta <- read_csv(data_url)\n```\n\n::: {.cell-output .cell-output-stderr}\n```\nRows: 20755 Columns: 9\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): Entity, Code\ndbl (7): Year, LifeExpectancy0, LifeExpectancy10, LifeExpectancy25, LifeExpe...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n:::\n\n```{.r .cell-code}\n# Alternatively\ntuesdata <- tidytuesdayR::tt_load('2023-12-05')\n```\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Compiling #TidyTuesday Information for 2023-12-05 ----\n--- There are 3 files available ---\n--- Starting Download ---\n```\n:::\n\n::: {.cell-output .cell-output-stdout}\n```\n\n\tDownloading file 1 of 3: `life_expectancy.csv`\n\tDownloading file 2 of 3: `life_expectancy_different_ages.csv`\n\tDownloading file 3 of 3: `life_expectancy_female_male.csv`\n```\n:::\n\n::: {.cell-output .cell-output-stderr}\n```\n--- Download complete ---\n```\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnames(tuesdata)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] \"life_expectancy\"                \"life_expectancy_different_ages\"\n[3] \"life_expectancy_female_male\"   \n```\n:::\n\n```{.r .cell-code}\nlife_expectancy <- tuesdata$life_expectancy\n\nn_distinct(life_expectancy$Entity)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n[1] 261\n```\n:::\n:::\n\n\n## Setting a global plot theme\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme_set(theme_minimal())\n```\n:::\n\n\n## Comparing life expectancy across regions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregions <- life_expectancy %>%\n  filter(str_detect(Entity, \"region\"))\n\nregions %>%\n  ggplot(aes(x = Year, y = LifeExpectancy)) +\n  geom_line(aes(col = Entity)) +\n  theme(legend.position = \"top\") +\n  annotate(geom = \"text\",\n           x = 1960, y = 50,\n           label = \"What happened here?\") +\n  geom_vline(xintercept = 2019, linetype = 2) +\n  annotate(geom = \"text\", x = 2019, y = 75,\n           label = \"Start of COVID pandemic\",\n           hjust = 1)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n## Difference in life expectancy between more and less developed regions\n\n\n::: {.cell}\n\n```{.r .cell-code}\nregions %>%\n  filter(Entity %in% c(\"More developed regions\",\n                       \"Less developed regions\"))  %>%\n  arrange(Year, Entity) %>%\n  group_by(Year) %>%\n  mutate(difference = LifeExpectancy - lag(LifeExpectancy)) %>%\n  filter(!is.na(difference)) %>%\n  ungroup() %>%\n  ggplot(aes(x = Year, y = difference)) +\n  geom_area(alpha = 0.5) +\n  expand_limits(y = 0) +\n  labs(title = \"Difference in life expectancy between more developed and less developed regions\",\n       y = \"Difference in life expectancy (years)\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\nWe look at life expectancy at different ages in three specific countries.\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_tidy <-\n  dta |>\n    pivot_longer(\n      cols = LifeExpectancy0:LifeExpectancy80\n    ) |>\n    mutate(\n      starting_age = str_remove(name, \"LifeExpectancy\") %>%\n        as.numeric()\n    ) |>\n    select(-name) |>\n    rename(e_x = value)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ndata_tidy |>\n  filter(\n    Entity %in% c(\n      \"Nigeria\", \"Iran\",\n      \"South Africa\"\n    )\n  ) |>\n  arrange(Year)  |>\n  ggplot(aes(Year, e_x, group = factor(starting_age), colour = factor(starting_age))) +\n  geom_line() +\n  facet_wrap(~Entity)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}